---
import Layout from '../layouts/Layout.astro';
import * as fs from 'fs';
import * as path from 'path';

// Load actual stats from data files
let stats = {
  totalShows: 4011,
  totalArtists: 3046,
};

try {
  const showsPath = path.join(process.cwd(), 'public/data/shows.json');
  const artistsPath = path.join(process.cwd(), 'public/data/artists.json');

  const showsData = JSON.parse(fs.readFileSync(showsPath, 'utf-8'));
  const artistsData = JSON.parse(fs.readFileSync(artistsPath, 'utf-8'));

  // Count only music shows (concert, open_mic - exclude improv)
  const musicShows = showsData.filter((s: any) =>
    ['concert', 'open_mic'].includes(s.eventType)
  );

  stats.totalShows = musicShows.length;
  stats.totalArtists = artistsData.length;
} catch (e) {
  console.error('Could not load stats from data files:', e);
}

// Load artists data to get IDs for notable artists
let notableArtistsWithLinks: Array<{name: string, id: string}> = [];
try {
  const artistsPath = path.join(process.cwd(), 'public/data/artists.json');
  const artistsData = JSON.parse(fs.readFileSync(artistsPath, 'utf-8'));

  const notableNames = ['Neon Trees', 'Imagine Dragons', 'The Moth & The Flame', 'Joshua James',
    'The National Parks', 'Fictionist', 'The Aces', 'Mindy Gledhill',
    'Alex Boye', 'Desert Noises'];

  notableArtistsWithLinks = notableNames.map((name: string) => {
    const artist = artistsData.find((a: any) => a.name === name);
    return {
      name,
      id: artist?.id || ''
    };
  }).filter((a: any) => a.id); // Only include artists we found
} catch (e) {
  console.error('Could not load artists data:', e);
}
---

<Layout title="Home">
  <!-- Hero Section -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-[#400106] via-gray-950 to-gray-950"></div>
    <div class="container mx-auto px-4 py-24 relative">
      <h1 class="text-5xl md:text-7xl text-white mb-6">
        Provo Music Museum
      </h1>
      <p class="text-xl md:text-2xl text-gray-300 max-w-3xl mb-6">
        A digital archive documenting the history of Provo's music scene.
      </p>
      <p class="text-lg text-gray-400 max-w-3xl mb-8">
        We're launching with our first exhibit: <span class="text-[#F0F0F0] font-semibold">20 years of live music history at Velour Live Music Gallery</span>.
        Explore the bands, the connections, and the stories that shaped Utah's music scene from 2006 to present.
      </p>
      <div class="flex flex-wrap gap-4">
        <a href="/network" class="bg-[#BF0404] hover:bg-[#F20505] text-white font-bold px-6 py-3 rounded-lg transition-colors">
          View Timeline
        </a>
        <a href="/artists" class="bg-[#400106] hover:bg-[#BF0404] text-white font-bold px-6 py-3 rounded-lg border border-[#BF0404] transition-colors">
          Browse Artists
        </a>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="container mx-auto px-4 py-16">
    <h2 class="text-3xl text-white mb-8 text-center">The Velour Archive</h2>
    <div class="grid grid-cols-2 gap-6 max-w-2xl mx-auto">
      <div class="card text-center">
        <div class="text-4xl font-bold text-[#F0F0F0] mb-2">{stats.totalShows.toLocaleString()}</div>
        <div class="text-gray-400">Shows</div>
      </div>
      <div class="card text-center">
        <div class="text-4xl font-bold text-[#F0F0F0] mb-2">{stats.totalArtists.toLocaleString()}</div>
        <div class="text-gray-400">Artists</div>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="container mx-auto px-4 py-16">
    <h2 class="text-3xl text-white mb-12 text-center">Explore the Archive</h2>
    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
      <a href="/network" class="card group">
        <div class="text-[#F0F0F0] text-4xl mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
        <h3 class="text-xl text-white mb-2 group-hover:text-[#F0F0F0] transition-colors">Timeline & Connections</h3>
        <p class="text-gray-400">Visualize 20 years of shows. Travel through time and see when bands were most active, who played with who, and how the scene evolved.</p>
      </a>

      <a href="/artists" class="card group">
        <div class="text-[#F0F0F0] text-4xl mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </div>
        <h3 class="text-xl text-white mb-2 group-hover:text-[#F0F0F0] transition-colors">Artists</h3>
        <p class="text-gray-400">Search and browse through thousands of artists who've performed at Velour. View their complete show history and connections.</p>
      </a>
    </div>
  </section>

  <!-- Notable Artists Section -->
  <section class="container mx-auto px-4 py-16">
    <h2 class="text-3xl text-white mb-8">Notable Artists from Velour</h2>
    <p class="text-gray-400 mb-8 max-w-3xl">
      Many artists who got their start at Velour went on to national and international success.
      Here are some notable names from the archive.
    </p>
    <div class="flex flex-wrap gap-3">
      {notableArtistsWithLinks.map((artist) => (
        <a
          href={`/artists/${encodeURIComponent(artist.id)}`}
          class="stat-badge hover:bg-[#BF0404] hover:text-white transition-colors"
        >
          {artist.name}
        </a>
      ))}
    </div>
  </section>

  <!-- CTA Section -->
  <section class="bg-gradient-to-r from-[#400106] to-gray-900 py-16">
    <div class="container mx-auto px-4 text-center">
      <h2 class="text-3xl text-white mb-4">Help Build the Museum</h2>
      <p class="text-gray-400 mb-8 max-w-2xl mx-auto">
        The Provo Music Museum is just getting started. The Velour archive is our first exhibit,
        but we're hoping to document more of Provo's rich music history. If you'd like to contribute
        data, stories, photos, or help with the project, please reach out.
      </p>
      <a href="mailto:dcheesman@gmail.com?subject=Provo Music Museum - Contribution" class="inline-block bg-[#BF0404] hover:bg-[#F20505] text-white font-bold px-8 py-4 rounded-lg transition-colors">
        Contact Dean Cheesman
      </a>
    </div>
  </section>
</Layout>
